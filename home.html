<!doctype html>
<html lang="en">
  <head>
    <title>Chat Example</title>
    <script type="text/javascript">
      window.onload = function () {
        var conn;
        var msg = document.getElementById("msg");
        var log = document.getElementById("log");

        function appendLog(item) {
          var doScroll =
            log.scrollTop > log.scrollHeight - log.clientHeight - 1;
          log.appendChild(item);
          if (doScroll) {
            log.scrollTop = log.scrollHeight - log.clientHeight;
          }
        }

        function createMessageElement(id, content) {
          var item = document.createElement("div");
          item.innerHTML =
            "<span>ID: " + id + ", Content: " + content + "</span>";

          // Edit Button
          var editButton = document.createElement("button");
          editButton.innerText = "Edit";
          editButton.onclick = function () {
            // Implement your edit logic here
            // You can use the 'id' and 'content' values to edit the message
          };
          item.appendChild(editButton);

          // Delete Button
          var deleteButton = document.createElement("button");
          deleteButton.innerText = "Delete";
          deleteButton.onclick = function () {
            // Implement your delete logic here
            // You can use the 'id' to identify the message to delete
          };
          item.appendChild(deleteButton);

          return item;
        }

        document.getElementById("form").onsubmit = function () {
          if (!conn) {
            return false;
          }
          if (!msg.value) {
            return false;
          }
          conn.send(JSON.stringify({ id: "", content: msg.value }));
          msg.value = "";
          return false;
        };

        if (window["WebSocket"]) {
          conn = new WebSocket("ws://" + document.location.host + "/ws");
          conn.onclose = function (evt) {
            var item = document.createElement("div");
            item.innerHTML = "<b>Connection closed.</b>";
            appendLog(item);
          };
          conn.onmessage = function (evt) {
            var messages = evt.data.split("\n");
            for (var i = 0; i < messages.length; i++) {
              var message = JSON.parse(messages[i]);
              var item = createMessageElement(message.id, message.content);
              appendLog(item);
            }
          };
        } else {
          var item = document.createElement("div");
          item.innerHTML = "<b>Your browser does not support WebSockets.</b>";
          appendLog(item);
        }
      };
    </script>
  </head>
  <body>
    <div id="log"></div>
    <form id="form">
      <input type="text" id="msg" size="64" autofocus autocomplete="off" />
      <input type="submit" value="Send" />
    </form>
  </body>
</html>
